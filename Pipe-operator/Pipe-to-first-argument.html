<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Pipe to first-argument | pipeR Tutorial</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.5.0">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
        
    
    
    <link rel="next" href="../Pipe-operator/Pipe-to-dot.html" />
    
    
    <link rel="prev" href="../Pipe-operator/README.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">

    
    <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-katex/katex.min.css">
    


        
    <div class="book" data-level="2.1" data-basepath=".." data-revision="1422058247268">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="Getting-started/README.html">
            
                
                    <a href="../Getting-started/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         Getting started
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="Getting-started/First-example.html">
            
                
                    <a href="../Getting-started/First-example.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         First example
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2" data-path="Getting-started/Design-principles.html">
            
                
                    <a href="../Getting-started/Design-principles.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                         Design principles
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="Pipe-operator/README.html">
            
                
                    <a href="../Pipe-operator/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Pipe operator
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter active" data-level="2.1" data-path="Pipe-operator/Pipe-to-first-argument.html">
            
                
                    <a href="../Pipe-operator/Pipe-to-first-argument.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                         Pipe to first-argument
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.2" data-path="Pipe-operator/Pipe-to-dot.html">
            
                
                    <a href="../Pipe-operator/Pipe-to-dot.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                         Pipe to dot
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.3" data-path="Pipe-operator/Pipe-by-formula.html">
            
                
                    <a href="../Pipe-operator/Pipe-by-formula.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                         Pipe by formula
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.4" data-path="Pipe-operator/Pipe-for-side-effect.html">
            
                
                    <a href="../Pipe-operator/Pipe-for-side-effect.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                         Pipe for side effect
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.5" data-path="Pipe-operator/Pipe-with-assignment.html">
            
                
                    <a href="../Pipe-operator/Pipe-with-assignment.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                         Pipe with assignment
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.6" data-path="Pipe-operator/Extract-element.html">
            
                
                    <a href="../Pipe-operator/Extract-element.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                         Extract element
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="Pipe-function/README.html">
            
                
                    <a href="../Pipe-function/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         Pipe function
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.1" data-path="Pipe-function/Pipe-to-first-argument.html">
            
                
                    <a href="../Pipe-function/Pipe-to-first-argument.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                         Pipe to first-argument
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.2" data-path="Pipe-function/Dot-function.html">
            
                
                    <a href="../Pipe-function/Dot-function.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                         Dot function
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.3" data-path="Pipe-function/Subsetting.html">
            
                
                    <a href="../Pipe-function/Subsetting.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                         Subsetting
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="4" data-path="Pipeline/README.html">
            
                
                    <a href="../Pipeline/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                         Pipeline
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="4.1" data-path="Pipeline/Argument.html">
            
                
                    <a href="../Pipeline/Argument.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                         Argument-based pipeline
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.2" data-path="Pipeline/Expression.html">
            
                
                    <a href="../Pipeline/Expression.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                         Expression-based pipeline
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="5" data-path="Examples/README.html">
            
                
                    <a href="../Examples/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                         Examples
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="5.1" data-path="Examples/dplyr.html">
            
                
                    <a href="../Examples/dplyr.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                         dplyr
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5.2" data-path="Examples/rlist.html">
            
                
                    <a href="../Examples/rlist.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                         rlist
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5.3" data-path="Examples/rvest.html">
            
                
                    <a href="../Examples/rvest.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                         rvest
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >pipeR Tutorial</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_16">
                    
                        <h1 id="pipe-to-first-argument">Pipe to first argument</h1>
<p>Many R functions are pipe-friendly: they take some data by the first argument and transform it in a certain way. This arrangement allows operations to be streamlined by pipes, that is, one data source can be put to the first argument of a function, get transformed, and put to the first argument of the next function. In this way, a chain of commands are connected, and it is called a pipeline.</p>
<p>Here is an example of reorganizing code in pipeline written with elementary functions.</p>
<p>Suppose the original code is</p>
<pre><code class="lang-r">summary(sample(diff(log(rnorm(<span class="hljs-number">100</span>,mean = <span class="hljs-number">10</span>))),
  size = <span class="hljs-number">10000</span>,replace = <span class="hljs-literal">TRUE</span>))
</code></pre>
<pre><code>#       Min.    1st Qu.     Median       Mean    3rd Qu.       Max. 
# -0.3013000 -0.0830800 -0.0116400 -0.0004926  0.0723500  0.2795000
</code></pre><p>Note that <code>rnorm()</code>, <code>log()</code>, <code>diff()</code>, <code>sample()</code>, and <code>summary()</code> all take the data as the first argument. We can use <code>%&gt;&gt;%</code> to rewrite the code so that the process of data transformation is straightforward.</p>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(pipeR)
set.seed(<span class="hljs-number">123</span>)
rnorm(<span class="hljs-number">100</span>, mean = <span class="hljs-number">10</span>) %&gt;&gt;%
  log %&gt;&gt;%
  diff %&gt;&gt;%
  sample(size = <span class="hljs-number">10000</span>, replace = <span class="hljs-literal">TRUE</span>) %&gt;&gt;%
  summary
</code></pre>
<pre><code>#      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
# -0.309500 -0.083720 -0.012360 -0.001854  0.071440  0.358400
</code></pre><p>The syntax of first argument piping is that, on the right-hand side of <code>%&gt;&gt;%</code>, whenever a function name or call is supplied, the left-hand side value will always be put to the first unnamed argument to that function.</p>
<table>
<thead>
<tr>
<th>Syntax</th>
<th>Evaluate as</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>x %&gt;&gt;% f</code></td>
<td><code>f(x)</code></td>
</tr>
<tr>
<td><code>x %&gt;&gt;% f(...)</code></td>
<td><code>f(x,...)</code></td>
</tr>
</tbody>
</table>
<p>Although you can write everything in one line but that is probably not very elegant. It is better to be generous to trade readability with the number of lines. </p>
<p>Note that, at each line, whenever we want to continue building the pipeline with the previous result, we end that line with <code>%&gt;&gt;%</code>. If one line does not end up with <code>%&gt;&gt;%</code>, the pipeline ends.</p>
<p>Some more examples with graphics functions:</p>
<pre><code class="lang-r">mtcars$mpg %&gt;&gt;%
  plot
</code></pre>
<pre><code class="lang-r">mtcars$mpg %&gt;&gt;%
  plot(col=<span class="hljs-string">&quot;red&quot;</span>)
</code></pre>
<p>Sometimes the value on the left is needed at multiple places. In this case you can use <code>.</code> to represent it anywhere in the function call.</p>
<p>Plot <code>mtcars$mpg</code> with a title indicating the number of points.</p>
<pre><code class="lang-r">mtcars$mpg %&gt;&gt;%
  plot(col=<span class="hljs-string">&quot;red&quot;</span>, main=sprintf(<span class="hljs-string">&quot;number of points: %d&quot;</span>,length(.)))
</code></pre>
<p><img src="figure/mtcars-with-title-1.png" title="plot of chunk mtcars-with-title" alt="plot of chunk mtcars-with-title" style="display: block; margin: auto;"></p>
<p>Take a sample from the lower letters of half the population.</p>
<pre><code class="lang-r">letters %&gt;&gt;%
  sample(size = length(.)/<span class="hljs-number">2</span>)
</code></pre>
<pre><code>#  [1] &quot;p&quot; &quot;j&quot; &quot;o&quot; &quot;x&quot; &quot;q&quot; &quot;e&quot; &quot;z&quot; &quot;u&quot; &quot;i&quot; &quot;l&quot; &quot;f&quot; &quot;a&quot; &quot;m&quot;
</code></pre><p>There are situations where one calls a function in a namespace with <code>::</code>. In this case, the call must end up with parentheses with or without parameters.</p>
<pre><code class="lang-r">mtcars$mpg %&gt;&gt;%
  stats::median()

mtcars$mpg %&gt;&gt;%
  graphics::plot(col = <span class="hljs-string">&quot;red&quot;</span>)
</code></pre>
<p>The same rule also applies when piping a value to a function in a list.</p>
<pre><code class="lang-r">functions &lt;- list(average = <span class="hljs-keyword">function</span>(x) mean(x))
mtcars$mpg %&gt;&gt;% functions$average()
mtcars$mpg %&gt;&gt;% functions[[<span class="hljs-string">&quot;average&quot;</span>]]()
</code></pre>
<p>In both cases above, <code>()</code> is necessary to make R expect the symbol before <code>()</code> to be a function, or otherwise <code>$</code> and <code>[[</code> themselves will be understandably regarded as <em>the</em> function we want to pipe value to.</p>
<p>Notice that <code>%&gt;&gt;%</code> not only works between function calls, but also can be nested in function calls. For example,</p>
<pre><code class="lang-r">mtcars %&gt;&gt;%
  subset(mpg &lt;= quantile(mpg,<span class="hljs-number">0.95</span>), c(mpg, wt)) %&gt;&gt;%
  summary
</code></pre>
<pre><code>#       mpg              wt       
#  Min.   :10.40   Min.   :1.513  
#  1st Qu.:15.28   1st Qu.:2.772  
#  Median :18.95   Median :3.438  
#  Mean   :19.22   Mean   :3.297  
#  3rd Qu.:21.48   3rd Qu.:3.690  
#  Max.   :30.40   Max.   :5.424
</code></pre><p>can be written like </p>
<pre><code class="lang-r">mtcars %&gt;&gt;%
  subset(mpg &lt;= mpg %&gt;&gt;% quantile(<span class="hljs-number">0.95</span>), c(mpg, wt)) %&gt;&gt;%
  summary
</code></pre>
<pre><code>#       mpg              wt       
#  Min.   :10.40   Min.   :1.513  
#  1st Qu.:15.28   1st Qu.:2.772  
#  Median :18.95   Median :3.438  
#  Mean   :19.22   Mean   :3.297  
#  3rd Qu.:21.48   3rd Qu.:3.690  
#  Max.   :30.40   Max.   :5.424
</code></pre><p>One important thing to notice here is that pipeR does not support lazy evaluation on left value, that is, the left value will be evaluated immediately which cannot be substituted by the function on the right. One example that may be supposed to work but actually not is</p>
<pre><code class="lang-r"><span class="hljs-number">10000</span> %&gt;&gt;% 
  replicate(rnorm(<span class="hljs-number">1000</span>)) %&gt;&gt;%
  system.time
</code></pre>
<pre><code>#    user  system elapsed 
#       0       0       0
</code></pre><p>This is not equivalent to</p>
<pre><code class="lang-r">system.time(replicate(<span class="hljs-number">10000</span>, rnorm(<span class="hljs-number">1000</span>)))
</code></pre>
<pre><code>#    user  system elapsed 
#    1.11    0.03    1.14
</code></pre><p>even if they actually cost almost the same time to compute. <code>system.time()</code> initiates a timing device when the evaluation starts. In this case however, the value on the left of <code>%&gt;&gt;%</code> is always evaluated <em>before</em> being put to the first argument of the function. That is why <code>system.time()</code> gets zero seconds because it only starts timing after the loop has finished! This is true for other functions that try to <em>compute on language</em>.</p>
<p>Therefore, you should always make sure that the left value should be valid in its own before putting it before <code>%&gt;&gt;%</code>.</p>
<p>In some other cases, the function is not very friendly to pipeline operation, that is, it does not take the data you transform through a pipeline as the first argument. One example is the linear model function <code>lm()</code>. This function take <code>formula</code> first and then <code>data</code>.</p>
<p>If you directly run</p>
<pre><code class="lang-r">mtcars %&gt;&gt;%
  lm(mpg ~ cyl + wt)
</code></pre>
<pre><code># Error in as.data.frame.default(data): cannot coerce class &quot;&quot;formula&quot;&quot; to a data.frame
</code></pre><p>it will fail because <code>%&gt;&gt;%</code> is evaluating <code>lm(mtcars, mpg ~ cyl + wt)</code> which does not fulfill the expectation of the function. There are two ways to build pipeline with such kind of functions.</p>
<p>First, use named parameter to specify the formula.</p>
<pre><code class="lang-r">mtcars %&gt;&gt;%
  lm(formula = mpg ~ cyl + wt)
</code></pre>
<pre><code># 
# Call:
# lm(formula = mpg ~ cyl + wt, data = .)
# 
# Coefficients:
# (Intercept)          cyl           wt  
#      39.686       -1.508       -3.191
</code></pre><p>This works because it is actually evaluated as </p>
<pre><code class="lang-r">lm(mtcars, formula = mpg ~ cyl + wt)
</code></pre>
<p>and R&apos;s argument matching program decides that since the first argument in <code>lm()</code>&apos;s definition <code>formula</code> is specified, the unnamed argument <code>mtcars</code> is regarded as specifying the second argument <code>data</code>, which is exactly what we want. Therefore, it works fine here.</p>
<p>However, this trick only makes it easy for some functions but not all. Suppose a function that takes <code>data</code> as the third or fourth argument. In this case, you would have to explicitly specify all previous arguments by name. If <code>data</code> argument follows <code>...</code>, the trick would not work at all.</p>
<p>Dot piping is designed for more flexible pipeline construction. It allows you to use <code>.</code> to represent the left-hand side value and put it anywhere you want in the next expression. The next page demonstrates its syntax and when it might be useful.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../Pipe-operator/README.html" class="navigation navigation-prev " aria-label="Previous page: Pipe operator"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../Pipe-operator/Pipe-to-dot.html" class="navigation navigation-next " aria-label="Next page: Pipe to dot"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-ga/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"ga":{"token":"UA-47159422-1","configuration":"auto"},"disqus":{"shortName":"renkun-ken"}};
    gitbook.start(config);
});
</script>

        <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-47159422-1', 'auto');ga('send', 'pageview');</script>
    </body>
    
</html>
